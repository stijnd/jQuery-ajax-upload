(function(a){a.ajaxUpload=function(g,m){var e={fieldname:"ajax_upload_field",upload_url:"upload.php",btn_text:"Browse"};var h=this;h.settings={};var j=a(g),g=g,i=true,d=null,k=null,l=null,f=null,b=null;h.init=function(){h.settings=a.extend({},e,m);var p=j.parents("form");var o=j.attr("name");var q=j.attr("id");var n=j.attr("class");d=a('<input type="hidden" name="'+o+'" id="'+q+'" class="'+n+'" />');j.after(d).remove();if(a(".upload_hidden_iframe").length<=0){k=a('<iframe frameborder="0" name="upload_hidden" class="upload_hidden_iframe" style="display:none;" />');a("body").append(k)}else{k=a(".upload_hidden_iframe")}if(a(".uploaden_hidden_form").length<=0){l=a('<form method="POST" enctype="multipart/form-data" action="'+h.settings.upload_url+'" class="uploaden_hidden_form" target="upload_hidden" style="visibility:hidden; height:0; width:0;"><input type="file" name="'+h.settings.fieldname+'" id="'+h.settings.fieldname+'" /></form>');a("body").append(l)}else{l=a(".uploaden_hidden_form")}b=a('<a href="#" class="ajax_upload_btn">'+h.settings.btn_text+"</a>");f=a('<span class="ajax_upload_loader" style="display:none;"></span>');d.after(b,f);b.click(function(r){r.preventDefault();c()})};var c=function(){k.unbind().load(function(o){var n=document.all?this.contentDocument.body.innerText:this.contentDocument.body.textContent;n=n.length>0?a.parseJSON(n):null;if(n!=null){if(n.succes){d.val(n.url);if(typeof h.settings.succes=="function"){h.settings.succes(n)}}else{if(typeof h.settings.error=="function"){h.settings.error(n.error)}}}else{if(!i){if(typeof h.settings.error=="function"){h.settings.error("The upload-handler could not be found on this url: "+h.settings.upload_url)}}}f.hide();k.unbind();a("#"+h.settings.fieldname,l).unbind()});a("#"+h.settings.fieldname,l).unbind().change(function(n){f.show();if(typeof h.settings.selected=="function"){h.settings.selected()}l.submit()});a("#"+h.settings.fieldname,l).click()};h.init()};a.fn.ajaxUpload=function(b){return this.each(function(){if(undefined==a(this).data("pluginName")){var c=new a.ajaxUpload(this,b);a(this).data("ajaxUpload",c)}})}})(jQuery);